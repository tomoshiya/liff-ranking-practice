# 🎮 RankQuest - 全体設計 壁打ち資料

**作成日**: 2026年1月17日  
**目的**: 開発を進める上で検討すべき論点を整理し、意思決定をサポートする

---

## 🎯 プロジェクトゴール（再確認）

### コアコンセプト
> 夫婦・カップルのコミュニケーションを促進して、仲のいい夫婦を増やしたい

### ターゲットユーザー
- **メインターゲット**: 夫婦・カップル（2人1組）
- **年齢層**: 20代〜40代
- **特徴**: LINEを日常的に使っている、お互いをもっと知りたい

### 成功指標（KPI案）
- アクティブペア数
- 週間プレイ率
- 平均プレイ回数/ペア
- 継続率（4週間後）

---

## 🔍 主要な検討ポイント

---

## 【論点1】開発スコープをどこまで広げるか

### A. MVP（最小限の機能）で素早くリリース ⭐⭐⭐⭐⭐ 推奨

#### 含める機能
1. ✅ **ランキング入力**
   - お題を1つ選ぶ
   - 1位〜5位を入力
   - LocalStorageに保存

2. ✅ **ペア登録**
   - ペアコード生成
   - コード入力で紐付け
   - Firebaseで管理

3. ✅ **予想と答え合わせ**
   - パートナーのランキングを3つ予想
   - 正解数を表示
   - シンプルな結果画面

4. ✅ **お題リスト**
   - 20〜30個のお題
   - カテゴリ分け
   - ランダム選択

#### 含めない機能（将来追加）
- ❌ 自動配信（手動でプレイ）
- ❌ 詳細なスコアリング（正解数のみ）
- ❌ 履歴・統計
- ❌ アバター・カスタマイズ

#### メリット
- ✅ 2〜4週間でリリース可能
- ✅ 早期にフィードバック取得
- ✅ 技術的リスク最小
- ✅ コアバリューに集中

#### デメリット
- ❌ 継続利用の仕組みが弱い
- ❌ ゲーム性がシンプル

---

### B. フル機能で完成度高くリリース

#### 含める機能
- すべての機能（自動配信、統計、ランキング、バッジなど）

#### メリット
- ✅ 継続利用しやすい
- ✅ ゲーム性が高い

#### デメリット
- ❌ 開発期間が3〜6ヶ月
- ❌ リスクが高い（途中で挫折の可能性）
- ❌ フィードバックを得るのが遅い

---

### 💡 推奨アプローチ

**「MVP → 段階的追加」方式**

```
フェーズ1（2〜3週間）: MVP
├─ ランキング入力
├─ ペア登録
├─ 予想・答え合わせ
└─ 20個のお題

リリース → テストユーザーで試用

フェーズ2（1〜2週間）: 改善
├─ UIブラッシュアップ
├─ お題追加（50個）
└─ バグフィックス

フェーズ3（2〜3週間）: エンゲージメント向上
├─ 履歴機能
├─ 統計機能
└─ バッジ・実績

フェーズ4（3〜4週間）: 自動化
├─ 週1配信
├─ リマインダー
└─ プッシュ通知
```

---

## 【論点2】ペア認証の実装方法

### 選択肢の比較

#### A. ペアコード方式（推奨）⭐⭐⭐⭐⭐

**仕組み**:
```
ユーザーA: 「ペアコード作成」をタップ
  ↓
システム: "ABC123" を生成、表示
  ↓
ユーザーA: 口頭またはLINEでBに伝える
  ↓
ユーザーB: コード入力画面で "ABC123" を入力
  ↓
システム: ペア成立！
```

**メリット**:
- ✅ 実装が簡単
- ✅ 確実に本人確認ができる
- ✅ セキュリティリスク低い

**デメリット**:
- ❌ 手入力の手間
- ❌ 入力ミスの可能性

**実装の詳細**:
```javascript
// コード生成
function generatePairCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 紛らわしい文字を除外
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars[Math.floor(Math.random() * chars.length)];
  }
  return code;
}

// データベース構造
pairs: {
  pairId: {
    code: "ABC123",
    user1Id: "LINE_USER_ID_1",
    user2Id: null, // まだ未登録
    status: "pending", // pending | active
    expiresAt: "2026-01-20T00:00:00Z" // 3日後に失効
  }
}
```

---

#### B. QRコード方式⭐⭐⭐⭐

**仕組み**:
```
ユーザーA: 「QRコード表示」をタップ
  ↓
システム: QRコードを画面に表示
  ↓
ユーザーB: スマホでQRコードをスキャン
  ↓
システム: ペア成立！
```

**メリット**:
- ✅ 入力ミスがない
- ✅ ユーザー体験が良い

**デメリット**:
- ❌ 実装がやや複雑
- ❌ QRコード生成ライブラリが必要
- ❌ カメラ権限が必要（LIFF制限あり）

**実装方法**:
```javascript
// QRコード生成（ライブラリ使用）
import QRCode from 'qrcode';

const pairUrl = `https://liff.line.me/${LIFF_ID}?pair=${pairCode}`;
QRCode.toDataURL(pairUrl, (err, url) => {
  // urlを<img>タグに設定
});
```

---

#### C. LINE友だち選択方式⭐

**仕組み**:
友だちリストから選択してペア登録

**メリット**:
- ✅ 最も直感的

**デメリット**:
- ❌ **LINE APIでは友だちリスト取得不可**（実装不可能）

---

### 💡 推奨

**「ペアコード（メイン） + QRコード（オプション）」の組み合わせ**

実装順序：
1. まずペアコード方式を実装（MVP）
2. 動作確認後、QRコード追加（フェーズ2）

---

## 【論点3】データベース選定

### 選択肢の比較

#### A. Firebase Realtime Database（推奨）⭐⭐⭐⭐⭐

**特徴**:
- リアルタイム同期
- NoSQLデータベース
- JSON形式

**メリット**:
- ✅ 無料枠が大きい（1GB保存、10GB転送/月）
- ✅ リアルタイム更新が簡単
- ✅ ドキュメント豊富
- ✅ LINE認証と相性良い
- ✅ 初心者向け

**デメリット**:
- ❌ 複雑なクエリが苦手
- ❌ データ構造の設計が重要

**コスト**:
```
無料枠:
- 保存: 1GB
- 転送: 10GB/月
- 同時接続: 100

想定利用量（100ペア = 200ユーザー）:
- 保存: 約5MB（1GBの0.5%）
- 転送: 約500MB/月（10GBの5%）

→ 当面は無料で運用可能
```

**データ構造例**:
```json
{
  "users": {
    "LINE_USER_ID_1": {
      "displayName": "たろう",
      "pictureUrl": "https://...",
      "partnerId": "LINE_USER_ID_2",
      "pairCode": "ABC123",
      "createdAt": 1705456789000
    }
  },
  "rankings": {
    "ranking_001": {
      "userId": "LINE_USER_ID_1",
      "themeId": "theme_001",
      "theme": "好きな食べ物TOP5",
      "ranking": {
        "1": "寿司",
        "2": "ラーメン",
        "3": "カレー",
        "4": "ピザ",
        "5": "ハンバーグ"
      },
      "status": "submitted",
      "createdAt": 1705456789000
    }
  },
  "guesses": {
    "guess_001": {
      "rankingId": "ranking_001",
      "guesserId": "LINE_USER_ID_2",
      "guesses": ["寿司", "ラーメン", "焼肉"],
      "result": {
        "correctCount": 2,
        "details": [...]
      },
      "createdAt": 1705456999000
    }
  }
}
```

---

#### B. Firestore⭐⭐⭐⭐

**特徴**:
- ドキュメント指向
- より高度なクエリ

**メリット**:
- ✅ 複雑なクエリが可能
- ✅ スケーラビリティ高い

**デメリット**:
- ❌ 無料枠が小さい（1GB保存、10GB転送/月は同じだが、読み書き回数制限）
- ❌ やや複雑

---

#### C. Supabase⭐⭐⭐

**特徴**:
- PostgreSQL
- オープンソース

**メリット**:
- ✅ SQL使える
- ✅ REST API

**デメリット**:
- ❌ Firebaseより複雑
- ❌ 日本語ドキュメント少ない

---

### 💡 推奨

**Firebase Realtime Database**

理由：
- 初心者に優しい
- 無料枠が十分
- リアルタイム機能が魅力
- ドキュメント豊富

---

## 【論点4】お題の管理方法

### フェーズごとの推奨方法

#### フェーズ1（MVP）: ハードコード⭐⭐⭐⭐⭐

```javascript
const themes = [
  {
    id: 'theme_001',
    title: '好きな食べ物TOP5',
    category: 'パーソナリティ',
    description: 'あなたの好きな食べ物・料理を教えてください'
  },
  {
    id: 'theme_002',
    title: '最近嬉しかったことTOP5',
    category: 'エモーション',
    description: '最近あった嬉しい出来事を教えてください'
  },
  // ...20〜30個
];
```

**メリット**:
- ✅ 超簡単
- ✅ すぐ実装できる

**デメリット**:
- ❌ 変更するにはコード修正が必要

---

#### フェーズ2: JSONファイル⭐⭐⭐⭐

```json
// themes.json
{
  "themes": [
    {
      "id": "theme_001",
      "title": "好きな食べ物TOP5",
      "category": "パーソナリティ",
      "description": "あなたの好きな食べ物・料理を教えてください",
      "difficulty": "easy"
    }
  ],
  "categories": [
    {
      "id": "personality",
      "name": "パーソナリティ",
      "description": "自分・相手を知るテーマ"
    }
  ]
}
```

**メリット**:
- ✅ コードとデータが分離
- ✅ 管理しやすい

---

#### フェーズ3: データベース⭐⭐⭐⭐⭐

**メリット**:
- ✅ 動的に追加・編集可能
- ✅ ユーザー投稿お題も可能
- ✅ お題の統計が取れる

---

### 💡 推奨

段階的に移行：
```
ハードコード（MVP）
  ↓ 動作確認OK
JSONファイル（フェーズ2）
  ↓ 100ペア達成
データベース（フェーズ3）
```

---

## 【論点5】ゲームフローの詳細設計

### パターンA: 同時入力・同時予想方式（推奨）⭐⭐⭐⭐⭐

```
【週の始まり】
両者: お題を確認

↓

【ステップ1: ランキング入力】
ユーザーA: ランキング入力 → 送信
ユーザーB: ランキング入力 → 送信

↓ 両者完了を待つ

【ステップ2: 予想入力】
ユーザーA: Bのランキングを3つ予想 → 送信
ユーザーB: Aのランキングを3つ予想 → 送信

↓ 両者完了を待つ

【ステップ3: 結果発表】
両者: 答え合わせ・スコア表示
      お互いのランキング公開
      コメント・感想共有
```

**メリット**:
- ✅ 公平
- ✅ 両者同時進行で盛り上がる
- ✅ シンプル

**デメリット**:
- ❌ 片方が入力しないと進まない
  → 解決策: リマインダー機能

---

### パターンB: 非同期方式

```
ユーザーA: ランキング入力 → 送信
  ↓ すぐに
ユーザーB: Aのランキングを予想可能
```

**メリット**:
- ✅ 待たなくて良い

**デメリット**:
- ❌ 先に入力した人が不利
- ❌ 非対称

---

### 💡 推奨

**パターンA（同時入力・同時予想）+ リマインダー**

リマインダーの実装：
- 24時間経過: 「パートナーが待ってます！」
- 48時間経過: 「まだ入力されていません」
- 72時間経過: そのお題はスキップ

---

## 【論点6】スコアリングとランキングシステム

### MVP版: シンプルスコア（推奨）⭐⭐⭐⭐⭐

```
正解数のみをカウント:
- 3つ予想して、2つ正解 → 2点
- 順位は考慮しない

結果表示:
「2個当たりました！」
「お互い合計4個当たりました！」
```

**メリット**:
- ✅ 分かりやすい
- ✅ 実装簡単

**デメリット**:
- ❌ ゲーム性が低い

---

### 拡張版: 順位考慮スコア⭐⭐⭐⭐

```
順位ボーナス:
- 1位を当てた: 5点
- 2位を当てた: 4点
- 3位を当てた: 3点
- 4位を当てた: 2点
- 5位を当てた: 1点

例:
予想 "寿司" が相手の1位 → 5点
予想 "ラーメン" が相手の3位 → 3点
予想 "焼肉" がランク外 → 0点
合計: 8点
```

**メリット**:
- ✅ ゲーム性が高い
- ✅ 1位を当てる楽しさ

**デメリット**:
- ❌ やや複雑

---

### 💡 推奨

**段階的に実装**:
```
MVP: シンプルスコア（正解数のみ）
  ↓ フィードバック収集
フェーズ2: 順位考慮スコア追加（オプション設定可能）
```

---

## 【論点7】UI/UX設計

### 画面構成（推奨）

#### 1. ホーム画面
```
┌─────────────────────────┐
│ 🎮 RankQuest      │
├─────────────────────────┤
│                         │
│   今週のお題              │
│ 「好きな食べ物TOP5」       │
│                         │
│  [ランキングを入力]        │
│                         │
│  待機中...               │
│  パートナーが入力中です    │
│                         │
├─────────────────────────┤
│  履歴  設定  ペア管理     │
└─────────────────────────┘
```

#### 2. ランキング入力画面
```
┌─────────────────────────┐
│ お題: 好きな食べ物TOP5     │
├─────────────────────────┤
│  1位: [____________]      │
│  2位: [____________]      │
│  3位: [____________]      │
│  4位: [____________]      │
│  5位: [____________]      │
├─────────────────────────┤
│      [送信する]           │
└─────────────────────────┘
```

#### 3. 予想入力画面
```
┌─────────────────────────┐
│ パートナーのランキングを   │
│ 3つ予想してください       │
├─────────────────────────┤
│  予想1: [____________]    │
│  予想2: [____________]    │
│  予想3: [____________]    │
├─────────────────────────┤
│      [予想を送信]         │
└─────────────────────────┘
```

#### 4. 結果画面
```
┌─────────────────────────┐
│ 結果発表！               │
├─────────────────────────┤
│ あなたの正解数: 2/3      │
│ パートナーの正解数: 2/3  │
│ 合計: 4個               │
├─────────────────────────┤
│ 【パートナーのランキング】 │
│ 1位: 寿司 ✅ あなたの予想 │
│ 2位: ラーメン ✅予想的中  │
│ 3位: カレー             │
│ 4位: ピザ              │
│ 5位: ハンバーグ         │
├─────────────────────────┤
│ 【あなたのランキング】     │
│ ...                    │
├─────────────────────────┤
│   [次のお題へ]           │
└─────────────────────────┘
```

---

### デザインの方向性

#### カラーパレット案
```
メインカラー: #FF6B9D (温かいピンク)
  - ボタン、アクセント

サブカラー: #6BCBFF (優しいブルー)
  - 背景、カード

アクセントカラー: #FFD93D (明るいイエロー)
  - 正解表示、ハイライト

テキスト:
  - メイン: #333333 (ダークグレー)
  - サブ: #666666 (ミドルグレー)

背景: #F5F5F5 (ライトグレー)
```

#### フォント
- **ゴシック体** (Noto Sans JP, Yu Gothic)
- サイズ: 16px以上（読みやすさ重視）

#### アイコン
- 絵文字を積極的に使う（親しみやすさ）
- 例: 🎮 ゲーム、💑 カップル、🏆 ランキング、❤️ お気に入り

---

## 【論点8】技術スタック最終決定

### フロントエンド
```
言語: JavaScript (Vanilla JS)
理由: シンプル、学習コスト低、LIFFと相性良い

将来的にReact/Vueも検討可能だが、MVPでは不要
```

### バックエンド
```
Firebase Realtime Database
理由: 無料、リアルタイム、初心者向け

+ Firebase Authentication
理由: LINE認証と連携しやすい
```

### ホスティング
```
GitHub Pages（現状維持）
理由: 無料、簡単、デプロイ自動化
```

### 開発ツール
```
エディタ: VSCode
バージョン管理: Git（将来的に導入）
デバッグ: Chrome DevTools + LIFF Inspector
```

---

## 【論点9】開発スケジュール（現実的な見積もり）

### 前提
- 開発時間: 週5〜10時間
- 非エンジニア（学習時間含む）

---

### フェーズ1: MVP開発（3〜4週間）

#### Week 1
- [ ] お題データ作成（20〜30個）
- [ ] お題表示機能
- [ ] ランキング入力フォーム
- [ ] LocalStorage保存

#### Week 2
- [ ] Firebase導入
- [ ] ユーザー登録・認証
- [ ] データベース基本設計
- [ ] ランキングデータ保存

#### Week 3
- [ ] ペアコード生成
- [ ] ペア登録機能
- [ ] パートナー情報取得
- [ ] データ共有

#### Week 4
- [ ] 予想入力機能
- [ ] 答え合わせロジック
- [ ] 結果表示
- [ ] 動作テスト

---

### フェーズ2: 改善・追加機能（2〜3週間）

- [ ] UIブラッシュアップ
- [ ] お題追加（50個）
- [ ] 履歴機能
- [ ] バグフィックス
- [ ] テストユーザーフィードバック反映

---

### フェーズ3: 本格リリース準備（2〜3週間）

- [ ] 利用規約・プライバシーポリシー作成
- [ ] ヘルプ・FAQ作成
- [ ] エラーハンドリング強化
- [ ] パフォーマンス最適化
- [ ] 正式リリース

---

## 🎯 最重要な意思決定事項まとめ

### 今すぐ決めるべきこと

#### 1. 開発スコープ
→ **推奨: MVP方式（段階的リリース）**

#### 2. ペア認証方法
→ **推奨: ペアコード方式**

#### 3. データベース
→ **推奨: Firebase Realtime Database**

#### 4. お題管理
→ **推奨: まずハードコード、後でJSON化**

#### 5. ゲームフロー
→ **推奨: 同時入力・同時予想方式**

#### 6. スコアリング
→ **推奨: まず正解数のみ、後で順位考慮追加**

---

## 📋 次回開発セッションでの TODO

### 最優先事項
1. **お題リスト作成**（30分〜1時間）
   - @RankQuest（仮）.md から抽出
   - 20〜30個を厳選
   - カテゴリ分類

2. **お題表示機能の実装**（1〜2時間）
   - ハードコードでOK
   - ランダム表示
   - シンプルなUI

3. **ランキング入力フォームの実装**（2〜3時間）
   - 5つの入力欄
   - バリデーション
   - LocalStorageに保存

---

## 💭 検討中の疑問・課題

### 技術的な疑問
1. **Firebase AuthenticationでLINE認証する方法**
   - カスタムトークンの生成
   - サーバーレス関数が必要？

2. **リアルタイム通知の実装**
   - パートナーが入力完了したら通知
   - Firebase Cloud Messaging?

### UX的な疑問
1. **初めてのユーザーをどう導くか**
   - チュートリアルは必要？
   - ビデオ？テキスト？

2. **ペア登録のタイミング**
   - 最初に必須？
   - 後からでもOK？

### ビジネス的な疑問
1. **テストユーザーをどう集めるか**
   - 友人・知人
   - SNSで募集
   - コミュニティで募集

2. **フィードバックの収集方法**
   - Googleフォーム
   - LINE直接
   - アプリ内フィードバック機能

---

## 🎉 まとめ：開発を成功させるためのポイント

### 1. 小さく始める
- ✅ MVPで素早くリリース
- ✅ フィードバックを早く得る
- ✅ 段階的に機能追加

### 2. ユーザー価値を最優先
- ✅ 技術よりもコミュニケーション促進
- ✅ シンプルで分かりやすいUX
- ✅ 夫婦・カップルの「楽しい」を追求

### 3. 継続できる設計
- ✅ 無理のない開発ペース
- ✅ 技術的負債を溜めない
- ✅ ドキュメントをしっかり残す

### 4. コミュニティを作る
- ✅ テストユーザーとの関係構築
- ✅ フィードバックループの確立
- ✅ 一緒に作る仲間を見つける

---

**あなたのアイデアは素晴らしいです。自信を持って、一歩ずつ進めていきましょう！** 🚀

---

**作成日**: 2026年1月17日  
**次回更新**: 開発方針決定後


