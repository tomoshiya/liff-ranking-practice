<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åµ„Åü„Çä„ÅÆ„Çâ„Çì„Åç„Çì„Åê</title>
    
    <!-- LIFF„ÅÆ„Éó„É≠„Ç∞„É©„É†„ÇíË™≠„ÅøËæº„ÇÄÔºàLINE„ÅåÊèê‰æõ„Åó„Å¶„ÅÑ„Çã„ÇÇ„ÅÆÔºâ -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
        /* ========================================
           „Éá„Ç∂„Ç§„É≥Ë®≠ÂÆö
           ======================================== */
        
        /* ÂÖ®‰Ωì„ÅÆ„É™„Çª„ÉÉ„Éà */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            background: linear-gradient(135deg, #E8F4F8 0%, #F0F8FF 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 25px 20px;
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.15);
        }
        
        h1 {
            color: #4A90E2;
            text-align: center;
            margin-bottom: 10px;
            font-size: 26px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 25px;
            padding: 0 10px;
        }
        
        .theme-box {
            background: linear-gradient(135deg, #F0F8FF 0%, #E8F4F8 100%);
            border: 3px solid #4A90E2;
            border-radius: 15px;
            padding: 20px 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .theme-box h2 {
            color: #4A90E2;
            font-size: 18px;
            margin: 0 0 10px 0;
        }
        
        .theme-text {
            color: #333;
            font-size: 16px;
            font-weight: bold;
            line-height: 1.6;
            word-break: break-all;
        }
        
        .ranking-form {
            margin: 20px 0;
        }
        
        .rank-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            gap: 10px;
        }
        
        .rank-label {
            background: linear-gradient(135deg, #4A90E2, #7AB8F5);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
            font-size: 15px;
            flex-shrink: 0;
        }
        
        .rank-input {
            flex: 1;
            padding: 12px 12px;
            border: 2px solid #B8D9F0;
            border-radius: 10px;
            font-size: 15px;
            transition: border-color 0.3s;
            width: 100%;
            min-width: 0;
        }
        
        .rank-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        
        button:hover {
            background: #3A7BC8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .secondary-button {
            background: #50C878;
        }
        
        .secondary-button:hover {
            background: #3FB869;
        }
        
        .history-list {
            margin: 20px 0;
        }
        
        .history-item {
            background: #f8f9fa;
            border-left: 4px solid #4A90E2;
            border-radius: 8px;
            padding: 15px;
            margin: 12px 0;
        }
        
        .history-theme {
            color: #4A90E2;
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 8px;
            word-break: break-all;
        }
        
        .history-date {
            color: #999;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .history-rankings {
            color: #555;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .loading {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }
        
        .error {
            background: #ffe0e0;
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px;
            color: #c92a2a;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        /* „Çπ„Éû„ÉõÊúÄÈÅ©Âåñ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 12px;
            }
            
            .theme-box {
                padding: 15px 12px;
            }
            
            .theme-box h2 {
                font-size: 16px;
            }
            
            .theme-text {
                font-size: 15px;
            }
            
            .rank-label {
                min-width: 45px;
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .rank-input {
                padding: 10px;
                font-size: 14px;
            }
            
            button {
                padding: 14px 18px;
                font-size: 15px;
            }
        }
        
        /* Ê•µÂ∞èÁîªÈù¢ÂØæÂøú */
        @media (max-width: 360px) {
            .rank-item {
                gap: 8px;
            }
            
            .rank-label {
                min-width: 40px;
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .rank-input {
                padding: 8px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ „Åµ„Åü„Çä„ÅÆ„Çâ„Çì„Åç„Çì„Åê</h1>
        <p class="subtitle">Á≠î„Åà„ÅØÁõ∏Êâã„ÅÆÂøÉ„ÅÆ‰∏≠„Å´ÔºÅ<br>„ÇÑ„Çå„Å∞„ÇÑ„Çã„Åª„Å©‰ª≤„ÅåÊ∑±„Åæ„Çã„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥„Ç≤„Éº„É†</p>
        
        <!-- Ë™≠„ÅøËæº„Åø‰∏≠„ÅÆË°®Á§∫ -->
        <div id="loading" class="loading">
            <p>Ë™≠„ÅøËæº„Åø‰∏≠...</p>
        </div>
        
        <!-- LINE„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„Ç®„É©„ÉºË°®Á§∫ -->
        <div id="error" class="error" style="display: none;">
            <p><strong>„Ç®„É©„Éº:</strong> „Åì„ÅÆ„Ç¢„Éó„É™„ÅØLINE„Åã„ÇâÈñã„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        </div>
        
        <!-- „É°„Ç§„É≥ÁîªÈù¢ -->
        <div id="mainScreen" class="screen">
            <button onclick="startRanking()">
                üéØ Êñ∞„Åó„ÅÑ„ÅäÈ°å„Åß„É©„É≥„Ç≠„É≥„Ç∞„Çí‰Ωú„Çã
            </button>
            
            <button onclick="showHistory()" class="secondary-button">
                üìã ÈÅéÂéª„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË¶ã„Çã
            </button>
        </div>
        
        <!-- „É©„É≥„Ç≠„É≥„Ç∞ÂÖ•ÂäõÁîªÈù¢ -->
        <div id="rankingScreen" class="screen">
            <div class="theme-box">
                <h2>üìå ‰ªäÂõû„ÅÆ„ÅäÈ°å</h2>
                <p class="theme-text" id="currentTheme">---</p>
            </div>
            
            <div class="ranking-form">
                <div class="rank-item">
                    <div class="rank-label">1‰Ωç</div>
                    <input type="text" class="rank-input" id="rank1" placeholder="1‰Ωç„ÇíÂÖ•Âäõ">
                </div>
                <div class="rank-item">
                    <div class="rank-label">2‰Ωç</div>
                    <input type="text" class="rank-input" id="rank2" placeholder="2‰Ωç„ÇíÂÖ•Âäõ">
                </div>
                <div class="rank-item">
                    <div class="rank-label">3‰Ωç</div>
                    <input type="text" class="rank-input" id="rank3" placeholder="3‰Ωç„ÇíÂÖ•Âäõ">
                </div>
                <div class="rank-item">
                    <div class="rank-label">4‰Ωç</div>
                    <input type="text" class="rank-input" id="rank4" placeholder="4‰Ωç„ÇíÂÖ•Âäõ">
                </div>
                <div class="rank-item">
                    <div class="rank-label">5‰Ωç</div>
                    <input type="text" class="rank-input" id="rank5" placeholder="5‰Ωç„ÇíÂÖ•Âäõ">
                </div>
            </div>
            
            <button onclick="saveRanking()">
                üíæ „É©„É≥„Ç≠„É≥„Ç∞„Çí‰øùÂ≠ò„Åô„Çã
            </button>
            
            <button onclick="backToMain()" class="secondary-button">
                ‚Üê „É°„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã
            </button>
        </div>
        
        <!-- Â±•Ê≠¥Ë°®Á§∫ÁîªÈù¢ -->
        <div id="historyScreen" class="screen">
            <h2 style="color: #4A90E2; margin-bottom: 20px;">üìã ÈÅéÂéª„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞</h2>
            
            <div id="historyList" class="history-list">
                <!-- „Åì„Åì„Å´Â±•Ê≠¥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô -->
            </div>
            
            <button onclick="backToMain()" class="secondary-button">
                ‚Üê „É°„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã
            </button>
        </div>
    </div>

    <script>
        // ========================================
        // „ÅäÈ°å„Éá„Éº„ÇøÔºà28ÂÄãÔºâ
        // ========================================
        const THEMES = [
            // „Ç®„É¢„Éº„Ç∑„Éß„É≥Á≥ªÔºà8ÂÄãÔºâ
            'ÊúÄËøë„ÄÅÂ¨â„Åó„Åã„Å£„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅÊ•Ω„Åó„Åã„Å£„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅÊÑüË¨ù„ÇíÊÑü„Åò„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅÊÑõ„ÇíÊÑü„Åò„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅ„Éè„Éû„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅÊÇ≤„Åó„Åã„Å£„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅ„É†„Ç´„Å§„ÅÑ„Åü„Åì„Å®„ÅØÔºü',
            'ÊúÄËøë„ÄÅ‰∏çÂÆâ„Å´ÊÑü„Åò„Å¶„ÅÑ„Çã„Åì„Å®„ÅØÔºü',
            
            // YearÁ≥ªÔºà2ÂÄãÔºâ
            '„Åì„ÅÆ1Âπ¥„Åß„ÄÅË≤∑„Å£„Å¶„Çà„Åã„Å£„Åü„ÇÇ„ÅÆ„ÅØÔºü',
            '„Åì„ÅÆ1Âπ¥„Åß„ÄÅË°å„Å£„Å¶„Çà„Åã„Å£„Åü„ÅäÂ∫ó„ÅØÔºü',
            
            // „Éë„Éº„ÇΩ„Éä„É™„ÉÜ„Ç£Á≥ªÔºà15ÂÄãÔºâ
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™È£ü„ÅπÁâ©„ÉªÊñôÁêÜTOP5',
            '„Çè„Åü„Åó„ÅÆÂ´å„ÅÑ„ÉªËã¶Êâã„Å™È£ü„ÅπÁâ©„ÉªÊñôÁêÜTOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™È£≤È£üÂ∫óTOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™Êò†ÁîªTOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™Êº´Áîª„Éª„Ç¢„Éã„É°TOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™„Ç≤„Éº„É†TOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™Âú∞Âüü„Éª„Ç®„É™„Ç¢TOP5',
            '„Çè„Åü„Åó„ÅÆÂè∂„Åà„Åü„ÅÑÂ§¢„ÉªÁõÆÊ®ôTOP5',
            '„Çè„Åü„Åó„ÅÆÂÆùÁâ©TOP5',
            '„Çè„Åü„Åó„ÅÆÂ•Ω„Åç„Å™Êú¨TOP5',
            '„Çè„Åü„Åó„ÅÆÊ¨≤„Åó„ÅÑ„ÇÇ„ÅÆTOP5',
            '„Çè„Åü„Åó„ÅÆ‰ºö„Å£„Å¶„Åø„Åü„ÅÑ‰∫∫TOP5',
            '„Çè„Åü„Åó„ÅÆÂ∞äÊï¨„Åô„Çã‰∫∫TOP5',
            '„Çè„Åü„Åó„ÅÆÂ≠¶ÁîüÊôÇ‰ª£„ÅÆÂæóÊÑèÁßëÁõÆTOP5',
            '„Çè„Åü„Åó„ÅÆÂ≠¶ÁîüÊôÇ‰ª£„ÅÆËã¶ÊâãÁßëÁõÆTOP5',
            
            // „Ç´„ÉÉ„Éó„É´Á≥ªÔºà3ÂÄãÔºâ
            '„Éë„Éº„Éà„Éä„Éº„ÅÆÂ•Ω„Åç„Å™„Å®„Åì„ÇçTOP5',
            '„Éë„Éº„Éà„Éä„Éº„Å´ÊÑüË¨ù„Çí„Åó„ÅüÂ†¥Èù¢„Éª„Ç∑„Éº„É≥TOP5',
            '„Éë„Éº„Éà„Éä„Éº„ÇíÁ¥†Êïµ„Å®ÊÑü„Åò„ÅüÂ†¥Èù¢„Éª„Ç∑„Éº„É≥TOP5'
        ];
        
        // ========================================
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        // ========================================
        const LIFF_ID = '2008911809-CBLKsbT1';
        let currentTheme = '';
        let userProfile = null;
        
        // ========================================
        // LIFFÂàùÊúüÂåñ
        // ========================================
        window.onload = function() {
            initializeLiff();
            setupEnterKeyNavigation();
        };
        
        function initializeLiff() {
            liff.init({
                liffId: LIFF_ID
            })
            .then(() => {
                if (liff.isLoggedIn()) {
                    getUserProfile();
                } else {
                    liff.login();
                }
            })
            .catch((err) => {
                console.error('LIFF„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').innerHTML = 
                    '<p><strong>„Ç®„É©„Éº:</strong> ' + err.message + '</p>';
            });
        }
        
        function getUserProfile() {
            liff.getProfile()
                .then(profile => {
                    userProfile = profile;
                    document.getElementById('loading').style.display = 'none';
                    showScreen('mainScreen');
                })
                .catch((err) => {
                    console.error('„Éó„É≠„Éï„Ç£„Éº„É´ÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', err);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                });
        }
        
        // ========================================
        // Enter„Ç≠„Éº„ÅßÊ¨°„ÅÆÂÖ•ÂäõÊ¨Ñ„Å´ÁßªÂãï
        // ========================================
        function setupEnterKeyNavigation() {
            for (let i = 1; i <= 5; i++) {
                const input = document.getElementById('rank' + i);
                input.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        if (i < 5) {
                            // Ê¨°„ÅÆÂÖ•ÂäõÊ¨Ñ„Å´„Éï„Ç©„Éº„Ç´„Çπ
                            document.getElementById('rank' + (i + 1)).focus();
                        } else {
                            // 5‰Ωç„ÅÆÂ†¥Âêà„ÅØ‰øùÂ≠ò„Éú„Çø„É≥„Å´„Éï„Ç©„Éº„Ç´„Çπ
                            this.blur();
                        }
                    }
                });
            }
        }
        
        // ========================================
        // ÁîªÈù¢Âàá„ÇäÊõø„Åà
        // ========================================
        function showScreen(screenId) {
            // „Åô„Åπ„Å¶„ÅÆÁîªÈù¢„ÇíÈùûË°®Á§∫
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            
            // ÊåáÂÆö„Åï„Çå„ÅüÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById(screenId).classList.add('active');
        }
        
        function backToMain() {
            showScreen('mainScreen');
        }
        
        // ========================================
        // „É©„É≥„Ç≠„É≥„Ç∞‰ΩúÊàêÊ©üËÉΩ
        // ========================================
        function startRanking() {
            // „É©„É≥„ÉÄ„É†„Å´„ÅäÈ°å„ÇíÈÅ∏„Å∂
            currentTheme = THEMES[Math.floor(Math.random() * THEMES.length)];
            document.getElementById('currentTheme').textContent = currentTheme;
            
            // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
            for (let i = 1; i <= 5; i++) {
                document.getElementById('rank' + i).value = '';
            }
            
            // „É©„É≥„Ç≠„É≥„Ç∞ÁîªÈù¢„Å´Âàá„ÇäÊõø„Åà
            showScreen('rankingScreen');
            
            // 1‰Ωç„ÅÆÂÖ•ÂäõÊ¨Ñ„Å´„Éï„Ç©„Éº„Ç´„Çπ
            setTimeout(() => {
                document.getElementById('rank1').focus();
            }, 100);
        }
        
        function saveRanking() {
            // ÂÖ•ÂäõÂÄ§„ÇíÂèñÂæó
            const rankings = [];
            for (let i = 1; i <= 5; i++) {
                const value = document.getElementById('rank' + i).value.trim();
                if (value === '') {
                    alert((i) + '‰Ωç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
                    document.getElementById('rank' + i).focus();
                    return;
                }
                rankings.push(value);
            }
            
            // LocalStorage„Åã„ÇâÊó¢Â≠ò„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
            let history = JSON.parse(localStorage.getItem('rankingHistory') || '[]');
            
            // Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÇíËøΩÂä†
            const newRanking = {
                theme: currentTheme,
                rankings: rankings,
                date: new Date().toISOString(),
                userName: userProfile ? userProfile.displayName : 'ÂêçÁÑ°„Åó'
            };
            
            history.unshift(newRanking); // ÈÖçÂàó„ÅÆÂÖàÈ†≠„Å´ËøΩÂä†
            
            // ÊúÄÂ§ß50‰ª∂„Åæ„Åß‰øùÊåÅ
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            // LocalStorage„Å´‰øùÂ≠ò
            localStorage.setItem('rankingHistory', JSON.stringify(history));
            
            alert('„É©„É≥„Ç≠„É≥„Ç∞„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ‚ú®');
            backToMain();
        }
        
        // ========================================
        // Â±•Ê≠¥Ë°®Á§∫Ê©üËÉΩ
        // ========================================
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('rankingHistory') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px 20px;">„Åæ„Å†„É©„É≥„Ç≠„É≥„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>Êñ∞„Åó„ÅÑ„ÅäÈ°å„Åß„É©„É≥„Ç≠„É≥„Ç∞„Çí‰Ωú„Å£„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>';
            } else {
                let html = '';
                history.forEach((item, index) => {
                    const date = new Date(item.date);
                    const dateStr = date.getFullYear() + 'Âπ¥' + 
                                  (date.getMonth() + 1) + 'Êúà' + 
                                  date.getDate() + 'Êó• ' + 
                                  date.getHours() + ':' + 
                                  String(date.getMinutes()).padStart(2, '0');
                    
                    html += '<div class="history-item">';
                    html += '<div class="history-theme">' + item.theme + '</div>';
                    html += '<div class="history-date">' + dateStr + ' by ' + item.userName + '</div>';
                    html += '<div class="history-rankings">';
                    item.rankings.forEach((rank, i) => {
                        html += '<div>' + (i + 1) + '‰Ωç: ' + rank + '</div>';
                    });
                    html += '</div>';
                    html += '</div>';
                });
                historyList.innerHTML = html;
            }
            
            showScreen('historyScreen');
        }
    </script>
</body>
</html>
